<script>
  function replaceUrl(element, attr) {
    let src = element.getAttribute(attr);
    if (src && src.length > 0 && !src.startsWith(parent.base)) {
      if (src.startsWith("data:")) {
        return;
      }
      element.setAttribute(attr, parent.parseURL('GET', src));
    }
  }

  window.XMLHttpRequest0 = XMLHttpRequest;
  const XMLHttpRequest0Handler = {
    get: function (obj, prop) {
      console.log(prop);
      if (prop === 'send') {
        return obj[prop];
      } else
        return obj[prop];
    }
  };
  delete window.XMLHttpRequest;
  window.XMLHttpRequest = function () {
    return new Proxy(new XMLHttpRequest0(), XMLHttpRequest0Handler);
  }
  window.document0 = {
    write:window.document.write,
    createElement:window.document.createElement
  };
  window.document.write = function(any){
    return window.document0.write(any);
  }
  window.document.createElement = function(any,options){
    const element = window.document0.createElement(any,options);
    Object.defineProperty(element,'src',{
      set: function(src){
        console.log(src);
        this.src = src;
      }
    })
  }
  window.addEventListener('unload', function (event) {
    parent.postMessage("navigation", "*");
  });
</script>
