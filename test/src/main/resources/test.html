<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Test</title>
  <script>
    function replaceUrl(element, attr) {
      let src = element.getAttribute(attr);
      if (src && src.length > 0 && !src.startsWith(parent.base)) {
        if (src.startsWith("data:")) {
          return;
        }
        element.setAttribute(attr, parent.parseURL('GET', src));
      }
    }

    window.XMLHttpRequest0 = XMLHttpRequest;
    const XMLHttpRequest0Handler = {
      get: function (obj, prop) {
        console.log(prop);
        if (prop === 'send') {
          return obj[prop];
        } else
          return obj[prop];
      }
    };
    delete window.XMLHttpRequest;
    window.XMLHttpRequest = function () {
      return new Proxy(new XMLHttpRequest0(), XMLHttpRequest0Handler);
    }
    window.document0 = {
      write:window.document.write.bind(window.document),
      createElement:window.document.createElement.bind(window.document)
    };
    window.document.write = function(any){
      return window.document0.write(any);
    }
    window.document.createElement = function(any,options){
      const element = window.document0.createElement(any,options);
      const proxy = new Node();
      Reflect.setPrototypeOf(proxy,element);
      Object.defineProperty(proxy,'src',{
        set: function(src){
          console.log(this);
          this.__proto__.src = src;
        }
      });
      return proxy;
    }
    window.addEventListener('unload', function (event) {
      parent.postMessage("navigation", "*");
    });
  </script>

</head>
<body>
<script>
  let x = document.createElement("img");
  x.src = "http://www.baidu.com/img/flexible/logo/pc/result.png"
  document.body.appendChild(x);
</script>
</body>
</html>
